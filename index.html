<script>
    function goHome() {
        document.getElementById('homePage').style.display = 'block';
        document.getElementById('cageDetails').style.display = 'none';
        document.getElementById('pregnancyDetails').style.display = 'none';
        document.getElementById('headerTitle').innerHTML = '<strong>RABBIT CAGE </strong>';
        loadCageButtons();  // Reload cage buttons
    }

    function showCageDetails(cageNumber) {
        document.getElementById('homePage').style.display = 'none';
        document.getElementById('cageDetails').style.display = 'block';
        loadData(cageNumber);
        document.getElementById('rabbitForm').dataset.cageNumber = cageNumber;
        document.getElementById('headerTitle').innerHTML = `<strong>CAGE ${cageNumber}</strong>`;
    }

    function togglePregnancyDetails(show) {
        document.getElementById('pregnancyDetails').style.display = show ? 'block' : 'none';
    }

    function saveData(event) {
        event.preventDefault();
        const form = document.getElementById('rabbitForm');
        const cageNumber = form.dataset.cageNumber;
        const data = new FormData(form);
        const obj = {};
        data.forEach((value, key) => {
            obj[key] = value;
        });
        localStorage.setItem(`rabbitData${cageNumber}`, JSON.stringify(obj));
        alert('Data saved successfully!');
        goHome();
    }

    function loadData(cageNumber) {
        let data = JSON.parse(localStorage.getItem(`rabbitData${cageNumber}`)) || {};
        document.getElementById('breed').value = data.breed || '';
        document.getElementById('family').value = data.family || '';
        document.getElementById('birthDate').value = data.birthDate || '';
        document.getElementById('weight').value = data.weight || '';
        if (data.pregnant === "yes") {
            document.querySelector('input[name="pregnant"][value="yes"]').checked = true;
            togglePregnancyDetails(true);
            document.getElementById('matedRabbit').value = data.matedRabbit || '';
            document.getElementById('pregnancyStart').value = data.pregnancyStart || '';
            document.getElementById('dueDate').value = data.dueDate || '';
        } else {
            document.querySelector('input[name="pregnant"][value="no"]').checked = true;
            togglePregnancyDetails(false);
        }
        if (data.foodIntake === "normal") {
            document.querySelector('input[name="foodIntake"][value="normal"]').checked = true;
        } else {
            document.querySelector('input[name="foodIntake"][value="irregular"]').checked = true;
        }
        if (data.mating === "yes") {
            document.querySelector('input[name="mating"][value="yes"]').checked = true;
        } else {
            document.querySelector('input[name="mating"][value="no"]').checked = true;
        }
        document.getElementById('note').value = data.note || '';
    }

    function deleteData() {
        const form = document.getElementById('rabbitForm');
        const cageNumber = form.dataset.cageNumber;
        if (confirm(`Are you sure you want to delete the data for Cage ${cageNumber}?`)) {
            localStorage.removeItem(`rabbitData${cageNumber}`);  // Remove the cage's data
            let totalCages = localStorage.getItem('totalCages') || 6;
            if (cageNumber == totalCages) {
                totalCages--;  // Reduce the total number of cages if it's the last cage
                localStorage.setItem('totalCages', totalCages);
            }
            alert(`Data for Cage ${cageNumber} deleted successfully!`);
            goHome();
        }
    }

    // Dynamically load cage buttons based on stored cage count
    function loadCageButtons() {
        let cageButtons = document.getElementById('cageButtons');
        cageButtons.innerHTML = '';  // Clear existing buttons

        let totalCages = localStorage.getItem('totalCages') || 6;  // Default to 6 cages
        for (let i = 1; i <= totalCages; i++) {
            let button = document.createElement('button');
            button.innerText = `CAGE ${i}`;
            button.onclick = function() { showCageDetails(i); };
            cageButtons.appendChild(button);
        }
    }

    // Add a new cage in sequence
    function addNewCage() {
        let totalCages = localStorage.getItem('totalCages') || 6;
        totalCages++;
        localStorage.setItem('totalCages', totalCages);
        loadCageButtons();
        alert(`CAGE ${totalCages} added!`);
    }

    // Load cage data if available in URL
    window.onload = function () {
        let cageNumber = new URLSearchParams(window.location.search).get('cage');
        if (cageNumber) {
            showCageDetails(cageNumber);
        } else {
            goHome();
        }
    }
</script>
