<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rabbit Cage</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <button onclick="goHome()">&#x1F3E0;</button> 
        <span id="headerTitle">Rabbit Cage</span>
        <button onclick="goToRabbitProfile()">&#x1F407;</button>
    </header>

    <div id="cageDetails">
        <form id="rabbitForm" onsubmit="saveData(event)">
            <!-- Form Fields -->
            <div>
                <label for="serialNumber">SERIAL NUMBER:</label>
                <input type="text" id="serialNumber" name="serialNumber" required>
            </div>
            <div>
                <label for="breed">BREED:</label>
                <input type="text" id="breed" name="breed">
            </div>
            <!-- Other fields like family, weight, etc., omitted for brevity -->
            <div class="buttons">
                <button type="submit">SUBMIT</button>
                <button type="button" onclick="goHome()">CANCEL</button>
                <button type="button" onclick="deleteCage()">DELETE CAGE</button>
            </div>
        </form>
    </div>

    <div id="homePage" class="cage-list" style="display: none;">
        <!-- Existing Cage Buttons -->
        <button onclick="showCageDetails(1)">CAGE 1</button>
        <button onclick="showCageDetails(2)">CAGE 2</button>
        <!-- Dynamically added cages -->
        <button onclick="addNewCage()">ADD NEW CAGE</button>
    </div>

<script>
    let totalCages = 6; // Initial total cages count
    let addedCages = []; // To track dynamically added cages
    let nextCageId = 7;  // This will ensure new cages get unique IDs

    function goHome() {
        document.getElementById('homePage').style.display = 'block';
        document.getElementById('cageDetails').style.display = 'none';
        document.getElementById('headerTitle').innerHTML = '<strong>RABBIT CAGE</strong>';
    }

    function showCageDetails(cageNumber) {
        document.getElementById('homePage').style.display = 'none';
        document.getElementById('cageDetails').style.display = 'block';
        loadData(cageNumber);
        document.getElementById('rabbitForm').dataset.cageNumber = cageNumber;
        document.getElementById('headerTitle').innerHTML = `<strong>CAGE ${cageNumber}</strong>`;
    }

    function saveData(event) {
        event.preventDefault();
        const form = document.getElementById('rabbitForm');
        const cageNumber = form.dataset.cageNumber;
        const data = new FormData(form);
        const obj = {};
        data.forEach((value, key) => {
            obj[key] = value;
        });
        localStorage.setItem(`rabbitData${cageNumber}`, JSON.stringify(obj));
        alert('Data saved successfully!');
        goHome();
    }

    function loadData(cageNumber) {
        let data = JSON.parse(localStorage.getItem(`rabbitData${cageNumber}`)) || {};
        document.getElementById('serialNumber').value = data.serialNumber || '';
        document.getElementById('breed').value = data.breed || '';
        // Load other fields in the same way...
    }

    function deleteCage() {
        const cageNumber = document.getElementById('rabbitForm').dataset.cageNumber;
        if (confirm(`Are you sure you want to delete Cage ${cageNumber}?`)) {
            // Remove data from localStorage
            localStorage.removeItem(`rabbitData${cageNumber}`);

            // Find and remove the button associated with this cage
            const cageButton = document.querySelector(`#homePage button[data-cage-id='${cageNumber}']`);
            if (cageButton) {
                cageButton.remove();
            }

            alert(`Cage ${cageNumber} has been deleted.`);
            goHome();
        }
    }

    function addNewCage() {
        // Create a new cage button with a unique ID
        const homePage = document.getElementById('homePage');
        const newCageButton = document.createElement('button');
        newCageButton.textContent = `CAGE ${nextCageId}`;
        newCageButton.dataset.cageId = nextCageId; // Unique ID for the new cage
        newCageButton.onclick = () => showCageDetails(nextCageId);

        // Insert new button before the 'Add New Cage' button
        homePage.insertBefore(newCageButton, homePage.lastElementChild);

        // Track this new cage
        addedCages.push(nextCageId);
        nextCageId++; // Increment ID for future cages
    }

    window.onload = function () {
        const urlParams = new URLSearchParams(window.location.search);
        const cageNumber = urlParams.get('cage');
        if (cageNumber) {
            showCageDetails(cageNumber);
        } else {
            goHome();
        }
    }
</script>
</body>
</html>
